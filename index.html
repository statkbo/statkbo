<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stats.KBO</title>
    <link rel="stylesheet" href="style.css"> <!-- 외부 CSS 파일 링크 -->
    <style>
        th {
            cursor: pointer; /* Make the headers clickable */
        }
    </style>
</head>
<body>

    <h1>
        <img src="https://raw.githubusercontent.com/statkbo/statkbo/main/logo.png" alt="stats.KBO Logo" style="vertical-align: middle; height: 1.2em;">
        <span style="font-size: 10px; color: #666; margin-left: 10px;">( 선수 성적 저작권 문제 시 삭제 )</span>
    </h1>

    <div class="filter-container">
        <label for="playerTypeFilter">투/타:</label>
        <select id="playerTypeFilter">
            <option value="타자">타자</option>
            <option value="투수">투수</option>
        </select>

        <label for="teamFilter">팀:</label>
        <select id="teamFilter">
            <option value="">All</option>
            <option value="Landers (KBO)">Landers (KBO)</option>
            <option value="Wiz (KBO)">Wiz (KBO)</option>
            <option value="Twins (KBO)">Twins (KBO)</option>
            <option value="Heroes (KBO)">Heroes (KBO)</option>
            <option value="Bears (KBO)">Bears (KBO)</option>
            <option value="Eagles (KBO)">Eagles (KBO)</option>
            <option value="Lions (KBO)">Lions (KBO)</option>
            <option value="Dinos (KBO)">Dinos (KBO)</option>
            <option value="Giants (KBO)">Giants (KBO)</option>
            <option value="Tigers (KBO)">Tigers (KBO)</option>
        </select>

        <label for="PosFilter" id="posFilterLabel">포지션:</label>
        <select id="PosFilter">
            <option value="">All</option>
            <option value="포수">C</option>
            <option value="1루">1B</option>
            <option value="2루">2B</option>
            <option value="3루">3B</option>
            <option value="유격">SS</option>
            <option value="좌익">LF</option>
            <option value="중견">CF</option>
            <option value="우익">RF</option>
            <option value="지명">DH</option>
        </select>

        <label for="plateAppearancesFilter">최소 이닝/타석 수:</label>
        <input type="number" id="plateAppearancesFilter" value="300" placeholder="Enter minimum PA/IP">

        <label for="nameSearch">선수 이름:</label>
        <input type="text" id="nameSearch" placeholder="Search by name">
    </div>

    <main>
        <div class="table-wrapper">
            <table id="statsTable">
                <thead id="tableHeader">
                    <tr class="batter-header">
                        <th onclick="sortTable(0, 'batter')">이름</th>
                        <th onclick="sortTable(1, 'batter')">팀</th>
                        <th onclick="sortTable(2, 'batter')">포지션</th>
                        <th onclick="sortTable(3, 'batter')">wRC+</th>
                        <th onclick="sortTable(4, 'batter')">WAR*</th>
                        <th onclick="sortTable(5, 'batter')">offWAR</th>
                        <th onclick="sortTable(6, 'batter')">타수</th>
                        <th onclick="sortTable(7, 'batter')">타석</th>
                        <th onclick="sortTable(8, 'batter')">안타</th>
                        <th onclick="sortTable(9, 'batter')">2루타</th>
                        <th onclick="sortTable(10, 'batter')">3루타</th>
                        <th onclick="sortTable(11, 'batter')">홈런</th>
                        <th onclick="sortTable(12, 'batter')">4구(고4X)</th>
                        <th onclick="sortTable(13, 'batter')">사구</th>
                        <th onclick="sortTable(14, 'batter')">희비</th>
                        <th onclick="sortTable(15, 'batter')">희번</th>
                        <th onclick="sortTable(16, 'batter')">고4</th>
                        <th onclick="sortTable(17, 'batter')">삼진</th>
                        <th onclick="sortTable(18, 'batter')">병살</th>
                        <th onclick="sortTable(19, 'batter')">도루</th>
                        <th onclick="sortTable(20, 'batter')">도루실패</th>
                        <th onclick="sortTable(21, 'batter')">득점</th>
                        <th onclick="sortTable(22, 'batter')">타점</th>
                        <th onclick="sortTable(23, 'batter')">타율</th>
                        <th onclick="sortTable(24, 'batter')">출루율</th>
                        <th onclick="sortTable(25, 'batter')">장타율</th>
                        <th onclick="sortTable(26, 'batter')">OPS</th>
                        <th onclick="sortTable(27, 'batter')">wOBA</th>
                        <th onclick="sortTable(28, 'batter')">wRAA</th>
                        <th onclick="sortTable(29, 'batter')">wSB</th>
                        <th onclick="sortTable(30, 'batter')">Spd</th>
                        <th onclick="sortTable(31, 'batter')">추정UBR</th>
                        <th onclick="sortTable(32, 'batter')">Pos</th>
                    </tr>
                    <tr class="pitcher-header" style="display: none;">
                        <th onclick="sortTable(0, 'pitcher')">이름</th>
                        <th onclick="sortTable(1, 'pitcher')">팀</th>
                        <th onclick="sortTable(2, 'pitcher')">fWAR</th>
                        <th onclick="sortTable(3, 'pitcher')">(RA9+f)/2 WAR</th>
                        <th onclick="sortTable(4, 'pitcher')">이닝</th>
                        <th onclick="sortTable(5, 'pitcher')">실점</th>
                        <th onclick="sortTable(6, 'pitcher')">자책점</th>
                        <th onclick="sortTable(7, 'pitcher')">삼진</th>
                        <th onclick="sortTable(8, 'pitcher')">피안타</th>
                        <th onclick="sortTable(9, 'pitcher')">4구</th>
                        <th onclick="sortTable(10, 'pitcher')">사구</th>
                        <th onclick="sortTable(11, 'pitcher')">피홈런</th>
                        <th onclick="sortTable(12, 'pitcher')">승</th>
                        <th onclick="sortTable(13, 'pitcher')">패</th>
                        <th onclick="sortTable(14, 'pitcher')">홀</th>
                        <th onclick="sortTable(15, 'pitcher')">세</th>
                        <th onclick="sortTable(16, 'pitcher')">ERA</th>
                        <th onclick="sortTable(17, 'pitcher')">FIP</th>
                        <th onclick="sortTable(18, 'pitcher')">ERA+</th>
                        <th onclick="sortTable(19, 'pitcher')">FIP+</th>
                        <th onclick="sortTable(20, 'pitcher')">WHIP</th>
                        <th onclick="sortTable(21, 'pitcher')">K/9</th>
                        <th onclick="sortTable(22, 'pitcher')">BB/9</th>
                        <th onclick="sortTable(23, 'pitcher')">K/BB</th>
                        <th onclick="sortTable(24, 'pitcher')">HR/9</th>
                        <th onclick="sortTable(25, 'pitcher')">RA9</th>
                        <th onclick="sortTable(26, 'pitcher')">WIN%</th>
                        <th onclick="sortTable(27, 'pitcher')">ERA-WAR</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be populated here -->
                </tbody>
            </table>
        </div>
    </main>

    <script>
        function loadCSV(playerType) {
            let file = playerType === '타자' ? 'stat.csv' : 'stat_pitcher.csv';

            // Set default values for the input field
            document.getElementById('plateAppearancesFilter').value = playerType === '타자' ? 300 : 100;

            fetch(file)
                .then(response => response.text())
                .then(data => {
                    // Parse CSV data and populate table
                    const rows = data.split('\n').map(row => row.split(','));

                    // Clear previous table rows
                    const tbody = document.querySelector('#statsTable tbody');
                    tbody.innerHTML = '';

                    // Populate table based on player type
                    rows.forEach(row => {
                        const newRow = document.createElement('tr');
                        row.forEach(cell => {
                            const newCell = document.createElement('td');
                            newCell.textContent = cell;
                            newRow.appendChild(newCell);
                        });
                        tbody.appendChild(newRow);
                    });

                    // Show/hide appropriate header
                    document.querySelector('.batter-header').style.display = playerType === '타자' ? '' : 'none';
                    document.querySelector('.pitcher-header').style.display = playerType === '투수' ? '' : 'none';
                });
        }

        function togglePosFilter(playerType) {
            const posFilter = document.getElementById('PosFilter');
            const posFilterLabel = document.getElementById('posFilterLabel');

            if (playerType === '투수') {
                posFilter.style.display = 'none';
                posFilterLabel.style.display = 'none';
            } else {
                posFilter.style.display = 'inline';
                posFilterLabel.style.display = 'inline';
            }
        }

        function sortTable(columnIndex, playerType) {
            const tbody = document.querySelector('#statsTable tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const isAscending = tbody.dataset.sortDirection === 'asc';

            rows.sort((a, b) => {
                const aText = a.children[columnIndex].textContent;
                const bText = b.children[columnIndex].textContent;

                return isAscending ? aText.localeCompare(bText) : bText.localeCompare(aText);
            });

            rows.forEach(row => tbody.appendChild(row));
            tbody.dataset.sortDirection = isAscending ? 'desc' : 'asc';
        }

        document.getElementById('playerTypeFilter').addEventListener('change', function() {
            loadCSV(this.value);
            togglePosFilter(this.value);
        });

        // Initialize the table with default player type
        loadCSV('타자');
    </script>
</body>
</html>
