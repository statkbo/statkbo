<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBO Stats</title>
    <link rel="stylesheet" href="style.css"> <!-- 외부 CSS 파일 링크 -->
</head>
<body>

    <h1>
        <img src="https://raw.githubusercontent.com/statkbo/statkbo/main/logo.png" alt="stats.KBO Logo" style="vertical-align: middle; height: 1.2em;">
        <span style="font-size: 10px; color: #666; margin-left: 10px;">( 선수 성적 저작권 문제 시 삭제 )</span>
    </h1>

    <div class="filter-container">
        <label for="playerType">Player Type:</label>
        <select id="playerType">
            <option value="타자">타자</option>
            <option value="투수">투수</option>
        </select>

        <label id="posFilterLabel" for="PosFilter">Position:</label>
        <select id="PosFilter">
            <option value="">All</option>
            <option value="포수">포수</option>
            <option value="1루수">1루수</option>
            <option value="2루수">2루수</option>
            <option value="3루수">3루수</option>
            <option value="유격수">유격수</option>
            <option value="좌익수">좌익수</option>
            <option value="중견수">중견수</option>
            <option value="우익수">우익수</option>
            <option value="지명타자">지명타자</option>
        </select>

        <label for="teamFilter">Team:</label>
        <input type="text" id="teamFilter" placeholder="Enter team name">

        <label for="nameSearch">Name:</label>
        <input type="text" id="nameSearch" placeholder="Enter player name">
    </div>

    <main>
        <div class="table-wrapper">
            <table id="statsTable">
                <thead id="tableHeader">
                    <tr class="batter-header">
                        <th data-column="이름">이름</th>
                        <th data-column="팀">팀</th>
                        <th data-column="포지션">포지션</th>
                        <th data-column="wRC+">wRC+</th>
                        <th data-column="WAR*">WAR*</th>
                        <th data-column="offWAR">offWAR</th>
                        <th data-column="타수">타수</th>
                        <th data-column="타석">타석</th>
                        <th data-column="안타">안타</th>
                        <th data-column="2루타">2루타</th>
                        <th data-column="3루타">3루타</th>
                        <th data-column="홈런">홈런</th>
                        <th data-column="4구(고4X)">4구(고4X)</th>
                        <th data-column="사구">사구</th>
                        <th data-column="희비">희비</th>
                        <th data-column="희번">희번</th>
                        <th data-column="고4">고4</th>
                        <th data-column="삼진">삼진</th>
                        <th data-column="병살">병살</th>
                        <th data-column="도루">도루</th>
                        <th data-column="도루실패">도루실패</th>
                        <th data-column="득점">득점</th>
                        <th data-column="타점">타점</th>
                        <th data-column="타율">타율</th>
                        <th data-column="출루율">출루율</th>
                        <th data-column="장타율">장타율</th>
                        <th data-column="OPS">OPS</th>
                        <th data-column="wOBA">wOBA</th>
                        <th data-column="wRAA">wRAA</th>
                        <th data-column="wSB">wSB</th>
                        <th data-column="Spd">Spd</th>
                        <th data-column="추정UBR">추정UBR</th>
                        <th data-column="Pos">Pos</th>
                    </tr>
                    <tr class="pitcher-header" style="display: none;">
                        <th data-column="이름">이름</th>
                        <th data-column="팀">팀</th>
                        <th data-column="fWAR">fWAR</th>
                        <th data-column="(RA9+f)/2 WAR">(RA9+f)/2 WAR</th>
                        <th data-column="이닝">이닝</th>
                        <th data-column="실점">실점</th>
                        <th data-column="자책점">자책점</th>
                        <th data-column="삼진">삼진</th>
                        <th data-column="피안타">피안타</th>
                        <th data-column="4구">4구</th>
                        <th data-column="사구">사구</th>
                        <th data-column="피홈런">피홈런</th>
                        <th data-column="승">승</th>
                        <th data-column="패">패</th>
                        <th data-column="홀">홀</th>
                        <th data-column="세">세</th>
                        <th data-column="ERA">ERA</th>
                        <th data-column="FIP">FIP</th>
                        <th data-column="ERA+">ERA+</th>
                        <th data-column="FIP+">FIP+</th>
                        <th data-column="WHIP">WHIP</th>
                        <th data-column="K/9">K/9</th>
                        <th data-column="BB/9">BB/9</th>
                        <th data-column="K/BB">K/BB</th>
                        <th data-column="HR/9">HR/9</th>
                        <th data-column="RA9">RA9</th>
                        <th data-column="WIN%">WIN%</th>
                        <th data-column="ERA-WAR">ERA-WAR</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 데이터가 로드된 후 여기에 추가됩니다. -->
                </tbody>
            </table>
        </div>
    </main>

    <script>
        document.getElementById('playerType').addEventListener('change', function() {
            loadCSV(this.value);
            togglePosFilter(this.value);
        });

        function togglePosFilter(playerType) {
            const posFilterLabel = document.getElementById('posFilterLabel');
            const posFilter = document.getElementById('PosFilter');
            if (playerType === '투수') {
                posFilterLabel.style.display = 'none';
                posFilter.style.display = 'none';
            } else {
                posFilterLabel.style.display = 'inline';
                posFilter.style.display = 'inline';
            }
        }

        function loadCSV(playerType) {
            let file = playerType === '타자' ? 'stat.csv' : 'stat_pitcher.csv';
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').map(row => row.split(','));
                    populateTable(rows);
                });
        }

        function populateTable(rows) {
            const tableBody = document.querySelector('#statsTable tbody');
            tableBody.innerHTML = '';

            rows.forEach(row => {
                const newRow = document.createElement('tr');
                row.forEach(cell => {
                    const newCell = document.createElement('td');
                    newCell.textContent = cell.trim();
                    newRow.appendChild(newCell);
                });
                tableBody.appendChild(newRow);
            });
        }

        document.querySelectorAll('#tableHeader th').forEach(th => {
            th.addEventListener('click', () => {
                const table = th.closest('table');
                const tbody = table.querySelector('tbody');
                const rows = Array.from(tbody.querySelectorAll('tr'));
                const index = Array.from(th.parentNode.children).indexOf(th);
                const isAscending = th.classList.toggle('sorted-asc');

                if (!isAscending) {
                    th.classList.remove('sorted-asc');
                    th.classList.add('sorted-desc');
                    rows.sort((a, b) => b.children[index].textContent.localeCompare(a.children[index].textContent));
                } else {
                    th.classList.remove('sorted-desc');
                    rows.sort((a, b) => a.children[index].textContent.localeCompare(b.children[index].textContent));
                }

                rows.forEach(row => tbody.appendChild(row));
            });
        });

        // 초기 데이터 로드
        loadCSV('타자');
    </script>
</body>
</html>
